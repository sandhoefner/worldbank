<!DOCTYPE html>
<meta charset="utf-8">
<title>World Bank DHS-CRU Vis</title>

<style>
</style>

<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="exploder.js"></script>

Top: Ghana. Bottom: Lesotho.<br>Left: max temp (blue cold, red hot). Right: wealth (blue rich, red poor).<br>

<script>
// create svg canvas
var margin = {top: 50, bottom: 10, left: 300, right: 40};
var width = 1250 - margin.left - margin.right;
var height = 950 - margin.top - margin.bottom;

var svg = d3.select("body").append("svg")
  .attr("width", width)
  .attr("height", height);

var projection = d3.geo.mercator()
  .scale(450)

var path = d3.geo.path()
  .projection(projection);

var exploder_lt = d3.geo.exploder()
  .projection(projection)
  .size(function(d, i) { return 270; })
  .position(function(d, i) {
    var px = Math.max(0, width - 9*60)/2
    return [418 + px + (i%10)*60, 703 + Math.floor(i/10)*60];
  });

var exploder_lt2 = d3.geo.exploder()
  .projection(projection)
  .size(function(d, i) { return 270; })
  .position(function(d, i) {
    var px = Math.max(0, width - 9*60)/2
    return [18 + px + (i%10)*60, 703 + Math.floor(i/10)*60];
  });

var exploder_gh = d3.geo.exploder()
  .projection(projection)
  .size(function(d, i) { return 545; })
  .position(function(d, i) {
    var px = Math.max(0, width - 9*60)/2
    return [440 + px + (i%10)*60, 300 + Math.floor(i/10)*60];
  });

var exploder_gh2 = d3.geo.exploder()
  .projection(projection)
  .size(function(d, i) { return 545; })
  .position(function(d, i) {
    var px = Math.max(0, width - 9*60)/2
    return [40 + px + (i%10)*60, 300 + Math.floor(i/10)*60];
  });

d3.json("LSO.json", function(data) {
  var units = topojson.feature(data, data.objects.units)
  var lso = svg.append("path")
    .datum(units)
    .attr("d", path)
    .attr("class", "path")
    .attr("stroke", "black")
    .attr("fill", "white");

  lso
    .call(exploder_lt);

  var lso2 = svg.append("path")
    .datum(units)
    .attr("d", path)
    .attr("class", "path")
    .attr("stroke", "black")
    .attr("fill", "white");

  lso2
    .call(exploder_lt2);
});

d3.json("GHA.json", function(data) {
  var units = topojson.feature(data, data.objects.units)

  var gha = svg.append("path")
    .datum(units)
    .attr("d", path)
    .attr("stroke", "black")
    .attr("fill", "white");

  gha
    .call(exploder_gh);

  var gha2 = svg.append("path")
    .datum(units)
    .attr("d", path)
    .attr("stroke", "black")
    .attr("fill", "white");

  gha2
    .call(exploder_gh2);
});

var mult_gh = 70;
var y_gh = 850;
var x1_gh = 300;
var x2_gh = 700;
var r_gh = 4;

var mult_lt = 110;
var y_lt = -2550;
var x1_lt = -2900;
var x2_lt = -2500;

var wealth_color = d3.scale.linear()
  // .domain([-233814, 387835])
  // .domain([-198563,359734])
  // .domain([0,1,2,3,4])
  .domain([-200000,200000])
  // .domain([-157002, 262743  ])
  // .range(["#FF0000", "#FF8080", "#8080FF", "#0000FF"]);
  .range(["red", "blue"]);

var heat_color_lt = d3.scale.linear()
  .domain([15.1, 23.2])
  .range(["blue", "red"]);

var heat_color_gh = d3.scale.linear()
  .domain([28.1, 33.3])
  .range(["blue", "red"]);

// load data
d3.csv("gh_lt_slim_CSV.csv", function(data) {

  var heat_node = svg.selectAll(".heat_node")
    .data(data)
    .enter()
    .append("g").attr("class", "heat_node")
    .attr("transform", function(d, i) {
      if (d.cc == "GH") {
        return "translate("+(x1_gh+mult_gh*d.longnum)+","+(y_gh-mult_gh*d.latnum)+")"
      } else {
        return "translate("+(x1_lt+mult_lt*d.longnum)+","+(y_lt-mult_lt*d.latnum)+")"
      }
    });

  var wealth_node = svg.selectAll(".wealth_node")
    .data(data)
    .enter()
    .append("g").attr("class", "wealth_node")
    .attr("transform", function(d, i) {
      if (d.cc == "GH") {
        return "translate("+(x2_gh+mult_gh*d.longnum)+","+(y_gh-mult_gh*d.latnum)+")"
      } else {
        return "translate("+(x2_lt+mult_lt*d.longnum)+","+(y_lt-mult_lt*d.latnum)+")"
      }
    });

  heat_node.append("circle")
    .attr("class", "circle")
    .attr("r", r_gh)
    .attr("fill", function(d) {
      // console.log(this);
      if (d.cc == "GH") {
        return heat_color_gh(d.hottest_month)
      } else {
        return heat_color_lt(d.hottest_month)
      }
    });

  wealth_node.append("circle")
    .attr("class", "circle")
    .attr("r", r_gh)
    .attr("fill", function(d) {
      // console.log(this);
      return wealth_color(d.wealth_nat)
    });
});

</script>
</body>
</html>